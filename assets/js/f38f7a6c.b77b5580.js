"use strict";(self.webpackChunkmobile_wallet_protocol=self.webpackChunkmobile_wallet_protocol||[]).push([[386],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(t),u=r,y=d["".concat(l,".").concat(u)]||d[u]||m[u]||s;return t?a.createElement(y,i(i({ref:n},c),{},{components:t})):a.createElement(y,i({ref:n},c))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9170:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const s={},i="Encryption",o={unversionedId:"spec/encryption",id:"spec/encryption",title:"Encryption",description:"MWP uses deep links for direct communication between peers.",source:"@site/docs/spec/encryption.md",sourceDirName:"spec",slug:"/spec/encryption",permalink:"/wallet-mobile-sdk/docs/spec/encryption",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"spec",previous:{title:"Batch requests",permalink:"/wallet-mobile-sdk/docs/spec/batch"},next:{title:"Handshake",permalink:"/wallet-mobile-sdk/docs/spec/handshake"}},l={},p=[{value:"Key generation",id:"key-generation",level:2},{value:"Key exchange to derive shared secret",id:"key-exchange-to-derive-shared-secret",level:2},{value:"Message <code>content</code> encryption",id:"message-content-encryption",level:2},{value:"Example message after encryption",id:"example-message-after-encryption",level:3},{value:"Example message before encryption (internal usage)",id:"example-message-before-encryption-internal-usage",level:3},{value:"Messages without encryption",id:"messages-without-encryption",level:2},{value:"Example handshake request message",id:"example-handshake-request-message",level:3},{value:"Example failure response message",id:"example-failure-response-message",level:3},{value:"Implementation",id:"implementation",level:2}],c={toc:p};function m(e){let{components:n,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,s,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"encryption"},"Encryption"),(0,r.kt)("p",null,"MWP uses deep links for direct communication between peers."),(0,r.kt)("p",null,"To ensure security, all messages in MWP after secure key exchange process are end-to-end encrypted."),(0,r.kt)("h2",{id:"key-generation"},"Key generation"),(0,r.kt)("p",null,"Both the client and the wallet generate their own key pair for each session via ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Key-agreement_protocol"},"Key-agreement protocol")," using ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Elliptic-curve_cryptography"},"Elliptic-curve"),"."),(0,r.kt)("p",null,"Each peer stores its private key in secure persistent storage\nand share its public key with the other party."),(0,r.kt)("h2",{id:"key-exchange-to-derive-shared-secret"},"Key exchange to derive shared secret"),(0,r.kt)("p",null,"MWP uses ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange"},"Diffie\u2013Hellman key exchange")," method to securely share cryptographic keys over deep links."),(0,r.kt)("p",null,"This method allows the two parties to derive the same shared secret offline using its own private key and the peer's public key."),(0,r.kt)("h2",{id:"message-content-encryption"},"Message ",(0,r.kt)("inlineCode",{parentName:"h2"},"content")," encryption"),(0,r.kt)("p",null,"After successful ",(0,r.kt)("a",{parentName:"p",href:"handshake"},"handshake process")," to exchange keys, subsequent messages (",(0,r.kt)("a",{parentName:"p",href:"messages#content"},(0,r.kt)("inlineCode",{parentName:"a"},"content")," data"),") are encrypted with the common shared secret using a symmetric-key algorithm."),(0,r.kt)("p",null,"It uses ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"},"AES"),"-",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Galois/Counter_Mode"},"GCM")," algorithm for cryptographic operations."),(0,r.kt)("h3",{id:"example-message-after-encryption"},"Example message after encryption"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "request": {\n      "data": "bgPGRoCBgH10b0IUhs8ZWRRPhFBGUlS3ESmB+xiGNb7n7oUdU9L9PGABmla/kCdnmES6iWXI7u5xzKm/CzPMGvlvlXLuRGlU4RjGJqbcQ55He3UcBXOgB0q489Vx2cx0fllrISuo87//kfcSolCWNSCHSBuSmojORG8YmO1L20724C8YKQrPxjmfWm5YyZxp/HyTnwX60eRJb819FZI4Zfc4RkTp4h+1A2lzBlERelr+MojfVBBBwxv4qQTAn7QRbUgoU+1CfblqcuB7bHUvfl+OwyZqIoxP68agkU9Na3aKDSM+oK6q9IBKG5X4Vz1+CBVchR5vggY+D7Omdaes6uDL443yV3uf8XHyv5ieWGgIS8bGgkdPvMrAtv78wdBr6iWLlh0pF7RyrPOWq/h8WiYerbAD9RFYhAxo1z3dymFgLamn/rf1LS+xu+sClKDrFx3DYkHEa/75CyQokBQiJFqO/sCTBLnXzV5I9bbjTTGuHi5tE/lKnsMsDz5tBpedavo9BT2bJNRUGh7yPMFybxV1hjyamlobBxyxik2GNjh09bINpZ4HVxe3mpmQWdg0NZiE5HG08HRHWooV+wQavMsWLqmOQtH30dy3+WMRSfURrrVdRXm0TZda6wCdU+sPbLPuvWucfdCTG62P8rGqklavjDQL8kkWAnsgMkCnAQJyoGqFHtGxjNd3rH5Pmkd7RC34fkEOsXxxKMzyOMlZjgr4a1MHO0URbrgA5k3IPdQ83Iq2GRpboshyHRyy27ClH6She9rQXUnbRI7WcGK/YCVu97rTxjWT8AzS8twI7egN6BhyricjMoUXNCewxWUBO4pp316mHtnPyktvFAZxF5Q/hbM2bcFQS2fdWooRUWlB405yv+magBC89GDbJHwBN73q3KTtYFVb5N7vDVIU71eGhL6ehve3NPcGxLKbRXWxWQnKNpIeWZ9W2mNWI5C6mbaasPbgGxW228OEs9FxjNmdA6XCScctgb8b31nM8xPOWeD+q33UIdNpQvkrZicPu7f5lGXGYibjsXnNWdO3tiOg6kuiHevt5Jqp35bO1Vn6y3UzZu6xwbUZQbE4NmR6j9BlGuNGS40Y91O/eCrFzSyayxPl6plRoekn2djBGHDyBZVwXfSKQef6gK9jV1RxQTjKbO6rDGR1hRgqWDvDeDLg03GBqwP93ZwqANK1jxpLOm0wbUycCl8grwAzTrZ0bJ68aUlT/Jmi3VAyV4QAwED8IZ0ipjLz7EmXkQWjuhChIiSwjkR6EEfctQhLK1+xvLsY796OSXG18qTAfjx2vgyGoxxrmEnufTIh4a9A+CTYQzNU137aRLXK/rN7Xs0d51xbis/FVm9ysgBNuWfxlOpVeahkvNSHzAM7Wn4WP/nlWp1yly/R/KrEE5iFi2dVxE9UMQFcbJ/xFDl+dj4hMJDFdCf1tyuP+ZCF6VSOjNUt6TCn2uXNTjIIJj2ZuH3O0YETcESMy+HwR8mmqn4DaFbbzRkZo7szOR3kGzKU8yk0fuW+McZtXfGd9YWG6wZEdMSV210jsmnDHklgHND87Zw0uZBdOWAYc6KzmTU1i2FxOEZaCjCGm9NDaVtgb1+gjrMUQN4KTuEWKaFpW74dZQymnfR9W/SYjH62DRLLEMDBV3xJDXl8fUgusnXMbLvf97fe/qZ7X1fgK70cWDJRTYSvziOC9knXQgOnr94bGaqWbzr7I2x6ODgTC6dczM9HJWOHjNvV8jouhgQIRldOaKA7ALLIEslhA6beJ/hnD2C2JpVwrcur/rCi2RZ5YOC3NKSvOv2sn4PG3++dpqHah1Zi4sdBKRxngSRCCcC1i123zmO3O4zSzI1i/Lo="\n    }\n  },\n  "timestamp": 689610765.957546,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "71BCE700-D717-4463-B4E4-4ECDCFC179A3"\n}\n')),(0,r.kt)("h3",{id:"example-message-before-encryption-internal-usage"},"Example message before encryption (internal usage)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "request": {\n      "actions": [\n        {\n          "paramsJson": "{\\"address\\":\\"0x571a6a108adb08f9ca54fe8605280F9EE0eD4AF6\\",\\"message\\":\\"message\\"}",\n          "method": "personal_sign",\n          "optional": false\n        },\n        {\n          "paramsJson": "{\\"typedDataJson\\":\\"{\\\\\\"types\\\\\\":{\\\\\\"Identity\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\",\\\\\\"name\\\\\\":\\\\\\"userId\\\\\\"},{\\\\\\"type\\\\\\":\\\\\\"address\\\\\\",\\\\\\"name\\\\\\":\\\\\\"wallet\\\\\\"}],\\\\\\"Bid\\\\\\":[{\\\\\\"name\\\\\\":\\\\\\"amount\\\\\\",\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"bidder\\\\\\",\\\\\\"type\\\\\\":\\\\\\"Identity\\\\\\"}],\\\\\\"EIP712Domain\\\\\\":[{\\\\\\"name\\\\\\":\\\\\\"name\\\\\\",\\\\\\"type\\\\\\":\\\\\\"string\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"version\\\\\\",\\\\\\"type\\\\\\":\\\\\\"string\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"chainId\\\\\\",\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"verifyingContract\\\\\\",\\\\\\"type\\\\\\":\\\\\\"address\\\\\\"},{\\\\\\"type\\\\\\":\\\\\\"bytes32\\\\\\",\\\\\\"name\\\\\\":\\\\\\"salt\\\\\\"}]},\\\\\\"primaryType\\\\\\":\\\\\\"Bid\\\\\\",\\\\\\"message\\\\\\":{\\\\\\"bidder\\\\\\":{\\\\\\"userId\\\\\\":323,\\\\\\"wallet\\\\\\":\\\\\\"0x3333333333333333333333333333333333333333\\\\\\"},\\\\\\"amount\\\\\\":100},\\\\\\"domain\\\\\\":{\\\\\\"salt\\\\\\":\\\\\\"0xf2d857f4a3edcb9b78b4d503bfe733db1e3f6cdc2b7971ee739626c97e86a558\\\\\\",\\\\\\"name\\\\\\":\\\\\\"DApp Browser Test DApp\\\\\\",\\\\\\"chainId\\\\\\":1,\\\\\\"version\\\\\\":\\\\\\"1\\\\\\",\\\\\\"verifyingContract\\\\\\":\\\\\\"0x1C56346CD2A2Bf3202F771f50d3D14a367B48070\\\\\\"}}\\",\\"address\\":\\"0x571a6a108adb08f9ca54fe8605280F9EE0eD4AF6\\"}",\n          "method": "eth_signTypedData_v3",\n          "optional": false\n        }\n      ]\n    }\n  },\n  "timestamp": 689610765.957546,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "71BCE700-D717-4463-B4E4-4ECDCFC179A3"\n}\n')),(0,r.kt)("h2",{id:"messages-without-encryption"},"Messages without encryption"),(0,r.kt)("p",null,"However, there are two exceptions where the content data are not encrypted:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Handshake calls from the client in order to exchange keys with the wallet"),(0,r.kt)("li",{parentName:"ol"},"Failure responses from wallet to return errors happening during the handshake processes")),(0,r.kt)("h3",{id:"example-handshake-request-message"},"Example handshake request message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "handshake": {\n      "appId": "com.coinbase.SampleClient",\n      "callback": "myappxyz://mycallback/wsegue",\n      "initialActions": [\n        {\n          "paramsJson": "{}",\n          "method": "eth_requestAccounts",\n          "optional": false\n        }\n      ]\n    }\n  },\n  "timestamp": 689587969.289106,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "451711FA-96B6-4955-B6EA-EFA78CEB89F5"\n}\n')),(0,r.kt)("h3",{id:"example-failure-response-message"},"Example failure response message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "failure": {\n      "requestId": "B78F510E-DD5C-4477-8350-7550FAC7452E",\n      "description": "Request denied"\n    }\n  },\n  "timestamp": 689611333.369556,\n  "uuid": "E485820B-8F5E-4F8C-9A00-CE5B5B9C6F35"\n}\n')),(0,r.kt)("h2",{id:"implementation"},"Implementation"),(0,r.kt)("p",null,"Coinbase's SDK is built with\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/cryptokit/"},"Apple CryptoKit")," for iOS,\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/google/tink"},"Google Tink")," and ",(0,r.kt)("a",{parentName:"p",href:"https://developer.android.com/jetpack/androidx/releases/security"},"androidx.security")," for Android."),(0,r.kt)("p",null,(0,r.kt)("img",{src:t(8053).Z,width:"1920",height:"2148"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"source: ",(0,r.kt)("a",{parentName:"p",href:"https://commons.wikimedia.org/wiki/File:Public_key_shared_secret.svg"},"https://commons.wikimedia.org/wiki/File:Public_key_shared_secret.svg"))))}m.isMDXComponent=!0},8053:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/diffie-hellman-1a6b4b3e77987f45033c8f4170e1729b.png"}}]);