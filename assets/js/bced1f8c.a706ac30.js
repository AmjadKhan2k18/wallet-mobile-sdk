"use strict";(self.webpackChunkmobile_wallet_protocol=self.webpackChunkmobile_wallet_protocol||[]).push([[150],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(t),u=r,g=m["".concat(i,".").concat(u)]||m[u]||d[u]||s;return t?a.createElement(g,l(l({ref:n},c),{},{components:t})):a.createElement(g,l({ref:n},c))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,l=new Array(s);l[0]=m;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<s;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5705:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const s={},l="Messages",o={unversionedId:"spec/messages",id:"spec/messages",title:"Messages",description:"Communications between client and server (wallet host) in MWP are through exchanging discrete stateless messages.",source:"@site/docs/spec/messages.md",sourceDirName:"spec",slug:"/spec/messages",permalink:"/wallet-mobile-sdk/docs/spec/messages",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"spec",previous:{title:"Overview",permalink:"/wallet-mobile-sdk/docs/spec"},next:{title:"Example",permalink:"/wallet-mobile-sdk/docs/spec/messages-example"}},i={},p=[{value:"Forms",id:"forms",level:2},{value:"Data form",id:"data-form",level:3},{value:"URL form",id:"url-form",level:3},{value:"Properties",id:"properties",level:2},{value:"<code>uuid</code>",id:"uuid",level:3},{value:"<code>sender</code>",id:"sender",level:3},{value:"<code>content</code>",id:"content",level:3},{value:"<code>timestamp</code>",id:"timestamp",level:3},{value:"<code>version</code>",id:"version",level:3},{value:"<code>callback</code>",id:"callback",level:3},{value:"Contents",id:"contents",level:2},{value:"Encryption",id:"encryption",level:3},{value:"Example message after encryption",id:"example-message-after-encryption",level:4},{value:"Example message before encryption (internal)",id:"example-message-before-encryption-internal",level:4},{value:"Messages without encryption",id:"messages-without-encryption",level:3},{value:"Example handshake request message",id:"example-handshake-request-message",level:4},{value:"Example failure response message",id:"example-failure-response-message",level:4}],c={toc:p};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"messages"},"Messages"),(0,r.kt)("p",null,"Communications between client and server (wallet host) in MWP are through exchanging discrete stateless messages."),(0,r.kt)("p",null,"The messages sent by the client app are called requests and the ones returned by the wallet host are called responses."),(0,r.kt)("h2",{id:"forms"},"Forms"),(0,r.kt)("p",null,"MWP messages can be transformed between two types according to their use cases."),(0,r.kt)("h3",{id:"data-form"},"Data form"),(0,r.kt)("p",null,"JSON object or corresponding data type in the language in use (e.g. Swift ",(0,r.kt)("inlineCode",{parentName:"p"},"struct"),", Kotlin ",(0,r.kt)("inlineCode",{parentName:"p"},"data class"),", or JavaScript object)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "uuid" : "634A5C15-0316-4FD1-86FB-4818DBD6C12D",\n  "sender" : "bwf9U+VbjmvfBr3p3aoJyOEKS6mq7sSrg56V6FDYMBs=",\n  "content" : {...},\n  "version" : "1.0.0",\n  "timestamp" : "1667475279"\n}\n')),(0,r.kt)("h3",{id:"url-form"},"URL form"),(0,r.kt)("p",null,"Deep link URL specifying recipient's address and base64 encoded ",(0,r.kt)("a",{parentName:"p",href:"#data-form"},"JSON object")," as query parameter"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"https://wallet.coinbase.com/wsegue?p=eyJ2ZXJzaW...U2RTMyQiJ9")),(0,r.kt)("h2",{id:"properties"},"Properties"),(0,r.kt)("h3",{id:"uuid"},(0,r.kt)("inlineCode",{parentName:"h3"},"uuid")),(0,r.kt)("p",null,"Unique id of the message"),(0,r.kt)("h3",{id:"sender"},(0,r.kt)("inlineCode",{parentName:"h3"},"sender")),(0,r.kt)("p",null,"Public key of the sender in base64 encoded string"),(0,r.kt)("h3",{id:"content"},(0,r.kt)("inlineCode",{parentName:"h3"},"content")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#contents"},"Message's content")," which might be encrypted by the sender using the derived shared secret"),(0,r.kt)("h3",{id:"timestamp"},(0,r.kt)("inlineCode",{parentName:"h3"},"timestamp")),(0,r.kt)("p",null,"UNIX millisecond timestamp"),(0,r.kt)("h3",{id:"version"},(0,r.kt)("inlineCode",{parentName:"h3"},"version")),(0,r.kt)("p",null,"Version of the protocol used by the sender"),(0,r.kt)("h3",{id:"callback"},(0,r.kt)("inlineCode",{parentName:"h3"},"callback")),(0,r.kt)("p",null,"(Optional) sender's callback URL"),(0,r.kt)("h2",{id:"contents"},"Contents"),(0,r.kt)("p",null,"Each ",(0,r.kt)("inlineCode",{parentName:"p"},"Message")," contains its ",(0,r.kt)("inlineCode",{parentName:"p"},"content"),". "),(0,r.kt)("h3",{id:"encryption"},"Encryption"),(0,r.kt)("p",null,"By default, the ",(0,r.kt)("inlineCode",{parentName:"p"},"content")," data are encrypted using the shared secret exchanged between the sender and receiver, so that it can be read only by the peers."),(0,r.kt)("h4",{id:"example-message-after-encryption"},"Example message after encryption"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "request": {\n      "data": "bgPGRoCBgH10b0IUhs8ZWRRPhFBGUlS3ESmB+xiGNb7n7oUdU9L9PGABmla/kCdnmES6iWXI7u5xzKm/CzPMGvlvlXLuRGlU4RjGJqbcQ55He3UcBXOgB0q489Vx2cx0fllrISuo87//kfcSolCWNSCHSBuSmojORG8YmO1L20724C8YKQrPxjmfWm5YyZxp/HyTnwX60eRJb819FZI4Zfc4RkTp4h+1A2lzBlERelr+MojfVBBBwxv4qQTAn7QRbUgoU+1CfblqcuB7bHUvfl+OwyZqIoxP68agkU9Na3aKDSM+oK6q9IBKG5X4Vz1+CBVchR5vggY+D7Omdaes6uDL443yV3uf8XHyv5ieWGgIS8bGgkdPvMrAtv78wdBr6iWLlh0pF7RyrPOWq/h8WiYerbAD9RFYhAxo1z3dymFgLamn/rf1LS+xu+sClKDrFx3DYkHEa/75CyQokBQiJFqO/sCTBLnXzV5I9bbjTTGuHi5tE/lKnsMsDz5tBpedavo9BT2bJNRUGh7yPMFybxV1hjyamlobBxyxik2GNjh09bINpZ4HVxe3mpmQWdg0NZiE5HG08HRHWooV+wQavMsWLqmOQtH30dy3+WMRSfURrrVdRXm0TZda6wCdU+sPbLPuvWucfdCTG62P8rGqklavjDQL8kkWAnsgMkCnAQJyoGqFHtGxjNd3rH5Pmkd7RC34fkEOsXxxKMzyOMlZjgr4a1MHO0URbrgA5k3IPdQ83Iq2GRpboshyHRyy27ClH6She9rQXUnbRI7WcGK/YCVu97rTxjWT8AzS8twI7egN6BhyricjMoUXNCewxWUBO4pp316mHtnPyktvFAZxF5Q/hbM2bcFQS2fdWooRUWlB405yv+magBC89GDbJHwBN73q3KTtYFVb5N7vDVIU71eGhL6ehve3NPcGxLKbRXWxWQnKNpIeWZ9W2mNWI5C6mbaasPbgGxW228OEs9FxjNmdA6XCScctgb8b31nM8xPOWeD+q33UIdNpQvkrZicPu7f5lGXGYibjsXnNWdO3tiOg6kuiHevt5Jqp35bO1Vn6y3UzZu6xwbUZQbE4NmR6j9BlGuNGS40Y91O/eCrFzSyayxPl6plRoekn2djBGHDyBZVwXfSKQef6gK9jV1RxQTjKbO6rDGR1hRgqWDvDeDLg03GBqwP93ZwqANK1jxpLOm0wbUycCl8grwAzTrZ0bJ68aUlT/Jmi3VAyV4QAwED8IZ0ipjLz7EmXkQWjuhChIiSwjkR6EEfctQhLK1+xvLsY796OSXG18qTAfjx2vgyGoxxrmEnufTIh4a9A+CTYQzNU137aRLXK/rN7Xs0d51xbis/FVm9ysgBNuWfxlOpVeahkvNSHzAM7Wn4WP/nlWp1yly/R/KrEE5iFi2dVxE9UMQFcbJ/xFDl+dj4hMJDFdCf1tyuP+ZCF6VSOjNUt6TCn2uXNTjIIJj2ZuH3O0YETcESMy+HwR8mmqn4DaFbbzRkZo7szOR3kGzKU8yk0fuW+McZtXfGd9YWG6wZEdMSV210jsmnDHklgHND87Zw0uZBdOWAYc6KzmTU1i2FxOEZaCjCGm9NDaVtgb1+gjrMUQN4KTuEWKaFpW74dZQymnfR9W/SYjH62DRLLEMDBV3xJDXl8fUgusnXMbLvf97fe/qZ7X1fgK70cWDJRTYSvziOC9knXQgOnr94bGaqWbzr7I2x6ODgTC6dczM9HJWOHjNvV8jouhgQIRldOaKA7ALLIEslhA6beJ/hnD2C2JpVwrcur/rCi2RZ5YOC3NKSvOv2sn4PG3++dpqHah1Zi4sdBKRxngSRCCcC1i123zmO3O4zSzI1i/Lo="\n    }\n  },\n  "timestamp": 689610765.957546,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "71BCE700-D717-4463-B4E4-4ECDCFC179A3"\n}\n')),(0,r.kt)("h4",{id:"example-message-before-encryption-internal"},"Example message before encryption (internal)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "request": {\n      "actions": [\n        {\n          "paramsJson": "{\\"address\\":\\"0x571a6a108adb08f9ca54fe8605280F9EE0eD4AF6\\",\\"message\\":\\"message\\"}",\n          "method": "personal_sign",\n          "optional": false\n        },\n        {\n          "paramsJson": "{\\"typedDataJson\\":\\"{\\\\\\"types\\\\\\":{\\\\\\"Identity\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\",\\\\\\"name\\\\\\":\\\\\\"userId\\\\\\"},{\\\\\\"type\\\\\\":\\\\\\"address\\\\\\",\\\\\\"name\\\\\\":\\\\\\"wallet\\\\\\"}],\\\\\\"Bid\\\\\\":[{\\\\\\"name\\\\\\":\\\\\\"amount\\\\\\",\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"bidder\\\\\\",\\\\\\"type\\\\\\":\\\\\\"Identity\\\\\\"}],\\\\\\"EIP712Domain\\\\\\":[{\\\\\\"name\\\\\\":\\\\\\"name\\\\\\",\\\\\\"type\\\\\\":\\\\\\"string\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"version\\\\\\",\\\\\\"type\\\\\\":\\\\\\"string\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"chainId\\\\\\",\\\\\\"type\\\\\\":\\\\\\"uint256\\\\\\"},{\\\\\\"name\\\\\\":\\\\\\"verifyingContract\\\\\\",\\\\\\"type\\\\\\":\\\\\\"address\\\\\\"},{\\\\\\"type\\\\\\":\\\\\\"bytes32\\\\\\",\\\\\\"name\\\\\\":\\\\\\"salt\\\\\\"}]},\\\\\\"primaryType\\\\\\":\\\\\\"Bid\\\\\\",\\\\\\"message\\\\\\":{\\\\\\"bidder\\\\\\":{\\\\\\"userId\\\\\\":323,\\\\\\"wallet\\\\\\":\\\\\\"0x3333333333333333333333333333333333333333\\\\\\"},\\\\\\"amount\\\\\\":100},\\\\\\"domain\\\\\\":{\\\\\\"salt\\\\\\":\\\\\\"0xf2d857f4a3edcb9b78b4d503bfe733db1e3f6cdc2b7971ee739626c97e86a558\\\\\\",\\\\\\"name\\\\\\":\\\\\\"DApp Browser Test DApp\\\\\\",\\\\\\"chainId\\\\\\":1,\\\\\\"version\\\\\\":\\\\\\"1\\\\\\",\\\\\\"verifyingContract\\\\\\":\\\\\\"0x1C56346CD2A2Bf3202F771f50d3D14a367B48070\\\\\\"}}\\",\\"address\\":\\"0x571a6a108adb08f9ca54fe8605280F9EE0eD4AF6\\"}",\n          "method": "eth_signTypedData_v3",\n          "optional": false\n        }\n      ]\n    }\n  },\n  "timestamp": 689610765.957546,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "71BCE700-D717-4463-B4E4-4ECDCFC179A3"\n}\n')),(0,r.kt)("h3",{id:"messages-without-encryption"},"Messages without encryption"),(0,r.kt)("p",null,"However, there are two exceptions where the content data are not encrypted:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Handshake calls from the client in order to exchange keys with the wallet"),(0,r.kt)("li",{parentName:"ol"},"Failure responses from wallet to return errors happening during the handshake processes")),(0,r.kt)("h4",{id:"example-handshake-request-message"},"Example handshake request message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "handshake": {\n      "appId": "com.coinbase.SampleClient",\n      "callback": "myappxyz://mycallback/wsegue",\n      "initialActions": [\n        {\n          "paramsJson": "{}",\n          "method": "eth_requestAccounts",\n          "optional": false\n        }\n      ]\n    }\n  },\n  "timestamp": 689587969.289106,\n  "callbackUrl": "myappxyz://mycallback/wsegue",\n  "uuid": "451711FA-96B6-4955-B6EA-EFA78CEB89F5"\n}\n')),(0,r.kt)("h4",{id:"example-failure-response-message"},"Example failure response message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.3",\n  "sender": "lEC/X3K68rlgOoldMdk0D77738Y7W0mDbMMV5R6VyCE=",\n  "content": {\n    "failure": {\n      "requestId": "B78F510E-DD5C-4477-8350-7550FAC7452E",\n      "description": "Request denied"\n    }\n  },\n  "timestamp": 689611333.369556,\n  "uuid": "E485820B-8F5E-4F8C-9A00-CE5B5B9C6F35"\n}\n')))}d.isMDXComponent=!0}}]);