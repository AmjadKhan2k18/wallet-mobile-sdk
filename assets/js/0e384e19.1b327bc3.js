"use strict";(self.webpackChunkmobile_wallet_protocol=self.webpackChunkmobile_wallet_protocol||[]).push([[671],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=l,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9881:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),l=(n(7294),n(3905));const i={sidebar_position:1},r="Mobile Wallet Protocol (MWP)",o={unversionedId:"intro",id:"intro",title:"Mobile Wallet Protocol (MWP)",description:"MWP is a protocol to allow mobile web3 apps to interact with wallet apps and access users' web3 accounts.",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/wallet-mobile-sdk/docs/intro",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"API Reference",permalink:"/wallet-mobile-sdk/docs/client-sdk/android-api-reference"}},s={},p=[{value:"Background",id:"background",level:2},{value:"Network layer",id:"network-layer",level:2},{value:"Message format",id:"message-format",level:2},{value:"Example",id:"example",level:3},{value:"handshake",id:"handshake",level:4},{value:"request",id:"request",level:4},{value:"response",id:"response",level:4},{value:"error",id:"error",level:4},{value:"Encryption",id:"encryption",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Handshake",id:"handshake-1",level:2},{value:"App metadata",id:"app-metadata",level:2},{value:"Batched request",id:"batched-request",level:2},{value:"Action",id:"action",level:2},{value:"Multi-chain support",id:"multi-chain-support",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"mobile-wallet-protocol-mwp"},"Mobile Wallet Protocol (MWP)"),(0,l.kt)("p",null,"MWP is a protocol to allow mobile web3 apps to interact with wallet apps and access users' web3 accounts. "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Secure: It provides an encrypted P2P communication channel between client and server (wallet host) to exchange discrete stateless messages."),(0,l.kt)("li",{parentName:"ul"},"Simple: The messages sent by the client app are called requests and the ones returned by the wallet host are called responses."),(0,l.kt)("li",{parentName:"ul"},"Direct: The protocol uses deep links as its transport layer to let participating apps deliver messages directly to their peer without external entities such as a bridge server."),(0,l.kt)("li",{parentName:"ul"},"Efficient: Reduces the number of hops between client applications and wallet via support for batch requests."),(0,l.kt)("li",{parentName:"ul"},"Reliable: It defines a decentralized verification procedure to check authenticity of each other using well-known URI standard for univeral link without a centralized registry.")),(0,l.kt)("h2",{id:"background"},"Background"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://images.ctfassets.net/c5bd0wqjc7v0/2L8Padm8D0FqNrgkE7lUDh/7460be599006828b8f803e8d4d4ee424/image4.png",alt:null})),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"To use mobile wallets with dapps, communication solutions like WalletLink or WalletConnect have been used, which require bridge servers to pass on dapp\u2019s requests and user\u2019s responses.\xa0"),(0,l.kt)("li",{parentName:"ul"},"These protocols were originally designed to deliver messages between entities located on different devices (desktop browser and user\u2019s mobile)."),(0,l.kt)("li",{parentName:"ul"},"For mobile use cases, where both app and wallet are within a single device, repurposing the existing solutions would be inefficient and moreover introduce reliability issues as they rely on a connection to an external server via web sockets.")),(0,l.kt)("h2",{id:"network-layer"},"Network layer"),(0,l.kt)("p",null,"Deep linking through universal links on iOS and app links on Android.\n(Intent on android.)"),(0,l.kt)("h2",{id:"message-format"},"Message format"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"JSON -> JSON with encrypted \u2018content\u2019 -> Base64 encoded -> deep link URL"),(0,l.kt)("li",{parentName:"ul"},"Base64 encoded string of JSON object"),(0,l.kt)("li",{parentName:"ul"},"Content of message prop is encrypted using the access token so that only the wallet can read"),(0,l.kt)("li",{parentName:"ul"},"Allow client to make batched requests")),(0,l.kt)("h3",{id:"example"},"Example"),(0,l.kt)("h4",{id:"handshake"},"handshake"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"URL\n",(0,l.kt)("inlineCode",{parentName:"li"},"https://go.cb-w.com/wsegue?p=eyJ2ZXJzaW9uIjoiMS4yLjMiLCJzZW5kZXIiOiI0UG9QTEFDUjNCb0VxWTJBdSthamRISGRSZStvU0ZaUVwvSkpDU091bHpTYz0iLCJjb250ZW50Ijp7ImhhbmRzaGFrZSI6eyJhcHBJZCI6ImNvbS5teWFwcC5wYWNrYWdlLmlkIiwiY2FsbGJhY2siOiJodHRwczpcL1wvbXlhcHAueHl6XC9uYXRpdmUtc2RrIiwiaW5pdGlhbEFjdGlvbnMiOlt7Im1ldGhvZCI6ImV0aF9zb21lTWV0aG9kIiwicGFyYW1zIjpbInBhcmFtMSIsInBhcmFtMiJdfV19fSwidXVpZCI6IjExMUYzRTI2LTE2N0YtNEJGNS1BQzM4LTZEOTNBNjU2RTMyQiJ9")),(0,l.kt)("li",{parentName:"ul"},"JSON (decoded the URL above. handshake messages are not encrypted)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version" : "0.1.0",\n  "sender" : "bwf9U+VbjmvfBr3p3aoJyOEKS6mq7sSrg56V6FDYMBs=",\n  "content" : {\n    "handshake" : {\n      "appId" : "com.coinbase.NativeWeb3App",\n      "callback" : "https:\\/\\/myapp.xyz\\/mycallback",\n      "initialActions" : [\n        {\n          "paramsJson" : "{}",\n          "method" : "eth_requestAccounts",\n          "optional" : false\n        },\n        {\n          "paramsJson" : "{\\"fromAddress\\":\\"\\",\\"data\\":\\"bWVzc2FnZQ==\\"}",\n          "method" : "personal_sign",\n          "optional" : false\n        }\n      ]\n    }\n  },\n  "uuid" : "634A5C15-0316-4FD1-86FB-4818DBD6C12D"\n}\n')),(0,l.kt)("h4",{id:"request"},"request"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"URL\n",(0,l.kt)("inlineCode",{parentName:"li"},"https://go.cb-w.com/wsegue?p=eyJ2ZXJzaW9uIjoiMS4yLjMiLCJzZW5kZXIiOiJmbW5IZVh3OTNlY000QnFzSXpRTk5zb2FvS0ZxK3NOMHZRaWdvaVNQZ2dvPSIsImNvbnRlbnQiOnsicmVxdWVzdCI6eyJfMCI6IkdQYUwwTWJjbVhoVWU5eUprY0p5dnRJWVJUM3RXNEhcL1lBUmNKTXZGZlZWOWh6OXcya1h3YmxIMEJPcFN2UXI0RVhoV0FVUlwvZGFwWUVMZ2lvTkFXY3IxVlwvY1JoNDVUaFN2SFV1cHRlY0lJR0tLeGxKTWdwZ2RiMWNJRWhNWEdpVElBYkZTblJTOVlwOFowOHJcL3pkcjlBVytFQjRXSXBLcnhTTmVqQXRRTDJWTDByRWE2YzhvM0lodG5DQ1U1SzRpaVVZcTJkamd0eGRJZm1FbmhrTUFCQVwvSm5INFpBPT0ifX0sInV1aWQiOiJEMzg3MUYwRS03QkNFLTQxMjYtQjY1Ny05QjlGOEQ1NEU3N0YifQ%3D%3D")),(0,l.kt)("li",{parentName:"ul"},"encrypted JSON (decoded from the URL above)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.2.3",\n  "sender": "oEC2AZndVwTcLs3ixQyxThlHrKBNdBczbWp9OjeglGY=",\n  "content": {\n    "request": {\n      "data": "/LzMCiGCpiYuUHp2vdlQM4V+f7hYygKI2qhX/ZWuFA6/aqZ/bmnWhROK14vtBH3sbrROqfefMXue3rbqLOg1s+xzh6iXoVavhIeCSevugp1ZlERG9q+CSuLXyRR3tou6wdsJ60jOTDjGzLCvcHp2ykglfDUr2qaVRo3i/RXsJRoPrW9CurSM9+TmNZ46aq1Y/K8lBcpq1aFUYSn7+kHHR8xBY+QoPE0yox+dZrvSi7Z16fX3uwZ3NQPmhPqQXpDFEHrZeKEzoIZAPA8NUlrajgY/1mxhbkH9tmM8X5vSG7w="\n    }\n  },\n  "uuid": "3E445386-8CB3-4995-99EC-DCF06A60081C"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"decrypted JSON (to pass via RN - native bridge)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.2.3",\n  "sender": "qSAE/fvQ1cnZvVnKDjiHRyzK6bVQ/qJ7W29DL2aMjns=",\n  "content": {\n    "request": {\n      "actions": [\n        {\n          "paramsJson" : "{}",\n          "method" : "eth_requestAccounts",\n          "optional" : false\n        },\n        {\n          "paramsJson" : "{\\"fromAddress\\":\\"\\",\\"data\\":\\"bWVzc2FnZQ==\\"}",\n          "method" : "personal_sign",\n          "optional" : false\n        }\n      ],\n      "account": {\n        "chain": "eth",\n        "networkId": 17,\n        "address": "0x12345678ABCD"\n      }\n    }\n  },\n  "uuid": "853BFBB5-A6F1-4FBA-B8C6-DC2BE3CCF6DF"\n}\n')),(0,l.kt)("h4",{id:"response"},"response"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"plain response JSON (to pass via RN - native bridge)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "7.13.1",\n  "sender": "u9IB3p8tN8P4U2LvYfaCphd8/bXRN34eTnuQPO4g6zQ=",\n  "content": {\n    "response": {\n      "requestId": "9D34C731-397B-473B-9850-C6F0261BC085",\n      "values": [\n        {\n          "result": {\n            "value": "return value 1"\n          }\n        },\n        {\n          "result": {\n            "value": "return value 2"\n          }\n        },\n        {\n          "error": {\n            "message": "error 1",\n            "code": 1\n          }\n        },\n        {\n          "error": {\n            "message": "error 2",\n            "code": 2\n          }\n        }\n      ]\n    }\n  },\n  "uuid": "C5CDDCF7-7A31-4185-BB6B-7A3B8F9B19BA"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"encrypted JSON (encrypted the JSON object above)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "7.13.1",\n  "sender": "u9IB3p8tN8P4U2LvYfaCphd8/bXRN34eTnuQPO4g6zQ=",\n  "content": {\n    "response": {\n      "requestId": "9D34C731-397B-473B-9850-C6F0261BC085",\n      "data": "uXqgB78alErYBFXie8gP397igJ18dx+mcQcUV7K44W+96OQxNxJGm3WxEgsGMxeS8Wg1wiiRaXYRghFbwlnJuOLNpIvAiQYMOzJ1IAlFg452hwG7PrCCn6e9/xU5Hc+kzZYio355zSxSuXByo1bItCgNdjp5aocX1kUnZceV7dGjIGv66/z1k93hxGYooH0uCeI2wQ7qaZzJKfUJLgO0NFmj1fbTciv7CoVd8/mQAfHzlgaIhkHB+j4mAw=="\n    }\n  },\n  "uuid": "C5CDDCF7-7A31-4185-BB6B-7A3B8F9B19BA"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"URL\n",(0,l.kt)("inlineCode",{parentName:"li"},"https://myapp.xyz/native-sdk?p=eyJ2ZXJzaW9uIjoiNy4xMy4xIiwic2VuZGVyIjoidTlJQjNwOHROOFA0VTJMdllmYUNwaGQ4XC9iWFJOMzRlVG51UVBPNGc2elE9IiwiY29udGVudCI6eyJyZXNwb25zZSI6eyJyZXF1ZXN0SWQiOiI5RDM0QzczMS0zOTdCLTQ3M0ItOTg1MC1DNkYwMjYxQkMwODUiLCJkYXRhIjoidVhxZ0I3OGFsRXJZQkZYaWU4Z1AzOTdpZ0oxOGR4K21jUWNVVjdLNDRXKzk2T1F4TnhKR20zV3hFZ3NHTXhlUzhXZzF3aWlSYVhZUmdoRmJ3bG5KdU9MTnBJdkFpUVlNT3pKMUlBbEZnNDUyaHdHN1ByQ0NuNmU5XC94VTVIYytrelpZaW8zNTV6U3hTdVhCeW8xYkl0Q2dOZGpwNWFvY1gxa1VuWmNlVjdkR2pJR3Y2NlwvejFrOTNoeEdZb29IMHVDZUkyd1E3cWFaekpLZlVKTGdPME5GbWoxZmJUY2l2N0NvVmQ4XC9tUUFmSHpsZ2FJaGtIQitqNG1Bdz09In19LCJ1dWlkIjoiQzVDRERDRjctN0EzMS00MTg1LUJCNkItN0EzQjhGOUIxOUJBIn0%3D"))),(0,l.kt)("h4",{id:"error"},"error"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"JSON (error messages are not encrypted)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "7.13.1",\n  "sender": "OzXg53x+wwIW1YCEbvP3sya7MmZT5yCQcArK3GbLmDo=",\n  "content": {\n    "failure": {\n      "requestId": "6C7706C2-B17F-4E96-8D52-C6876C09AECB",\n      "description": "error message from host"\n    }\n  },\n  "uuid": "C6900BD5-25EE-46F4-AB01-EBB8FAB1AC76"\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"URL\n",(0,l.kt)("inlineCode",{parentName:"li"},"https://myapp.xyz/native-sdk?p=eyJ2ZXJzaW9uIjoiNy4xMy4xIiwic2VuZGVyIjoiT3pYZzUzeCt3d0lXMVlDRWJ2UDNzeWE3TW1aVDV5Q1FjQXJLM0diTG1Ebz0iLCJjb250ZW50Ijp7ImZhaWx1cmUiOnsicmVxdWVzdElkIjoiNkM3NzA2QzItQjE3Ri00RTk2LThENTItQzY4NzZDMDlBRUNCIiwiZGVzY3JpcHRpb24iOiJlcnJvciBtZXNzYWdlIGZyb20gaG9zdCJ9fSwidXVpZCI6IkM2OTAwQkQ1LTI1RUUtNDZGNC1BQjAxLUVCQjhGQUIxQUM3NiJ9"))),(0,l.kt)("h2",{id:"encryption"},"Encryption"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange"},"Diffie\u2013Hellman key exchange")),(0,l.kt)("li",{parentName:"ul"},"client and wallet generate its own key pair for each session and derive shared key with peer\u2019s public key"),(0,l.kt)("li",{parentName:"ul"},"For pairing (handshake) process: public key encryption to grant access token visible only to the caller"),(0,l.kt)("li",{parentName:"ul"},"After successful handshake: access token itself is the shared key to encrypt all messages between the client and the wallet for secure communication")),(0,l.kt)("h2",{id:"authentication"},"Authentication"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Decentralized verification of participating apps\u2019 authenticity using ",(0,l.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Well-known_URI"},".well-known")," data without centralized registry"),(0,l.kt)("li",{parentName:"ul"},"apple-app-site-association "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://developer.android.com/training/app-links/verify-site-associations"},"assetlinks.json")),(0,l.kt)("li",{parentName:"ul"},"3rd party client apps make requests to the wallet through universal links, whose authenticity is verified by the OS."),(0,l.kt)("li",{parentName:"ul"},"Wallet sends responses through universal links as well."),(0,l.kt)("li",{parentName:"ul"},"Application ID passed by caller should match the information on their domain.")),(0,l.kt)("h2",{id:"handshake-1"},"Handshake"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Host wallet verifies the client app",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"well-known data for universal link configuration"))),(0,l.kt)("li",{parentName:"ul"},"Fetch metadata of the app such as app\u2019s name and icon image url "),(0,l.kt)("li",{parentName:"ul"},"Show UI (e.g. user confirmation popup) to get user\u2019s approval"),(0,l.kt)("li",{parentName:"ul"},"Generate a key pair for session")),(0,l.kt)("h2",{id:"app-metadata"},"App metadata"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"This protocol only asks client apps to pass their application id."),(0,l.kt)("li",{parentName:"ul"},"Then it loads metadata from the iOS App Store / Android package manager.")),(0,l.kt)("h2",{id:"batched-request"},"Batched request"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"allow client apps to make multiple requests at once "),(0,l.kt)("li",{parentName:"ul"},"to improve UX by minimizing app switching"),(0,l.kt)("li",{parentName:"ul"},"Currently, CB wallet opens pop-ups sequentially to get user\u2019s approval until the user signs all the actions requests or denies to sign any required action")),(0,l.kt)("h2",{id:"action"},"Action"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Request can have multiple actions"),(0,l.kt)("li",{parentName:"ul"},"Each action defines a single json rpc call with parameters"),(0,l.kt)("li",{parentName:"ul"},"Response has multiple ActionResult ")),(0,l.kt)("h2",{id:"multi-chain-support"},"Multi-chain support"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Follow ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/ChainAgnostic/CAIPs/blob/master/CAIPs/caip-10.md"},"CAIP-10")," standard, to identify an account in any blockchain specified by CAIP-2 blockchain id"),(0,l.kt)("li",{parentName:"ul"},"The account id specification will be prefixed with the CAIP-2 blockchain ID and delimited with a colon sign (:)"),(0,l.kt)("li",{parentName:"ul"},"Syntax",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"The account_id is a case-sensitive string in the form"),(0,l.kt)("li",{parentName:"ul"},'account_id: chain_id + ":" + account_address'),(0,l.kt)("li",{parentName:"ul"},"chain_id: ","[-a-z0-9]","{3,8}:","[-a-zA-Z0-9]","{1,32}"),(0,l.kt)("li",{parentName:"ul"},"account_address: ","[a-zA-Z0-9]","{1,64}"))),(0,l.kt)("li",{parentName:"ul"},"Semantics",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"The chain_id is specified by the CAIP-2 which describes the blockchain id. The account_address is a case sensitive string which its format is specific to the blockchain that is referred to by the chain_id"))),(0,l.kt)("li",{parentName:"ul"},"Example:",(0,l.kt)("br",{parentName:"li"}),"eip155:1:0xab16a96d359ec26a11e2c2b3d8f8b8942d5bfcdb")))}u.isMDXComponent=!0}}]);